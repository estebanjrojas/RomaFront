<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Gestion Comercial</title>
    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.min.js"></script>
  </head>
  <script>
    // Definimos los parametros en x y en y
    var valX = [1, 2, 3, 4, 5, 6, 7];
    var valY = [100, 110, 90, 80, 150, 130, 50];

    //Creamos una funcion asincrona (para que se active hasta que termine de cargar la pagina)
    async function learnLinear() {
      //Definimos el modelo que sera de regresion lineal
      const model = tf.sequential();
      //Agregamos una capa densa porque todos los nodos estan conectado entre si
      model.add(tf.layers.dense({ units: 1, inputShape: [1] }));

      // Compilamos el modelo con un sistema de perdida de cuadratico y optimizamos con sdg
      model.compile({ loss: "meanSquaredError", optimizer: "sgd" });
      // Creamos los tensores para x y para y
      const xs = tf.tensor2d(valX, [7, 1]);
      const ys = tf.tensor2d(valY, [7, 1]);

      // Obtenemos la epoch (Las veces que se repetira para encontrar el valor de x)
      var epocas = +document.getElementById("repeticiones").value;
      // Obtenemos el valor de x
      //var nuevoValX = +document.getElementById("nuevoValX").value;

      // Ciclo que ajusta el calculo
      for (i = 0; i < epocas; i++) {
        //se entrena el modelo con "fit"
        await model.fit(xs, ys, { epochs: 1 });
        // Obtenemos el valor de Y cuando el valor de X sea
        var prediccionY = model.predict(tf.tensor2d([8], [1, 1])).dataSync()[0];
        // Escribimos el valor de y
        document.getElementById("valy").innerText = prediccionY;
        // Escribimos en que epoch vamos
        document.getElementById("epocas").innerText = i + 1;
      }
    }
  </script>
  <body>
    <app-root></app-root>
  </body>
</html>
